#version 330 core

out vec4 fragColor;

uniform vec2 resolution;
uniform float time;

const float tmax = 100.0;

void rotate(inout vec2 p, float a) {
	float s = sin(a);
	float c = cos(a);

	p = mat2(c, s, -s, c)*p;
}

vec4 orb;
float md = 0.6;
float fl = 1.0;

float map(vec3 p) {
	p.x -= 2.0;
	p.y += 0.8;
	p.z = mod(p.z + 1.0, 2.0) - 1.0;

	vec4 q = vec4(p, 1.0);
	vec4 o = q;

	orb = vec4(1000.0);

	for(int i = 0; i < 11; i++) {
		rotate(q.xy, 1.00);
		q.xyz = clamp(q.xyz, -fl, fl)*2.0 - q.xyz;
		float r = dot(q.xyz, q.xyz);
		q *= clamp(max(md/r, md), 0.0, 1.0);
		q = (3.0/md)*q - o;

		orb = min(orb, vec4(abs(q.xyz), r));
	}

	return (length(q.xyz) - 2.0)/q.w - pow(3.0, -10.0) - 0.01;
}

vec2 march(vec3 ro, vec3 rd) {
	float t = 0.0;
	float g = 0.0;

	for(int i = 0; i < 250; i++) {
		float d = map(ro + rd*t);
		if(d < 0.00007*(1.0 + 80.0*t) || t >= tmax) break;
		t += d*(0.25 + 0.1*t);

		g += 0.01;
	}

	return vec2(t, t >= tmax ? 0.0 : clamp(g, 0.0, 1.0));
}

vec3 normal(vec3 p) {
	vec2 h = vec2(0.0001, 0.0);
	vec3 n = vec3(
		map(p + h.xyy) - map(p - h.xyy),
		map(p + h.yxy) - map(p - h.yxy),
		map(p + h.yyx) - map(p - h.yyx)
	);
	return normalize(n);
}

float ao(vec3 p, vec3 n) {
	float s = 0.01, t = s;
	float o = 0.0, w = 1.0;

	for(int i = 0; i < 15; i++) {
		float d = map(p + n*t);

		o += (t - d)*w;
		w *= 0.95;

		t += s;
	}

	return 1.0 - clamp(o, 0.0, 1.0);
}

void cameraPath(inout vec3 p, inout vec3 d, float t) {
	t = mod(t, 71.544556);
	if(t >= 0.000000 && t < 1.001835) {
		p = mix(vec3(-0.000000, 0.000000, -3.242997),vec3(0.000000, 0.000000, -3.000000), abs(1.001835 - t)/1.001835);
		d = mix(vec3(-0.000000, 0.000000, -1.000000),vec3(0.000000, 0.000000, -1.000000), abs(1.001835 - t)/1.001835);
	} else if(t >= 1.001835 && t < 2.002189) {
		p = mix(vec3(0.015079, 0.001659, -3.842640),vec3(-0.000000, 0.000000, -3.242997), abs(2.002189 - t)/1.000354);
		d = mix(vec3(0.095842, 0.008727, -0.995358),vec3(-0.000000, 0.000000, -1.000000), abs(2.002189 - t)/1.000354);
	} else if(t >= 2.002189 && t < 3.018836) {
		p = mix(vec3(0.110989, 0.009431, -4.444439),vec3(0.015079, 0.001659, -3.842640), abs(3.018836 - t)/1.016647);
		d = mix(vec3(0.199360, -0.008727, -0.979887),vec3(0.095842, 0.008727, -0.995358), abs(3.018836 - t)/1.016647);
	} else if(t >= 3.018836 && t < 4.019665) {
		p = mix(vec3(0.213616, -0.033886, -5.033746),vec3(0.110989, 0.009431, -4.444439), abs(4.019665 - t)/1.000828);
		d = mix(vec3(0.121406, -0.087156, -0.988769),vec3(0.199360, -0.008727, -0.979887), abs(4.019665 - t)/1.000828);
	} else if(t >= 4.019665 && t < 5.019853) {
		p = mix(vec3(0.254597, -0.073841, -5.631124),vec3(0.213616, -0.033886, -5.033746), abs(5.019853 - t)/1.000188);
		d = mix(vec3(0.052286, -0.043619, -0.997679),vec3(0.121406, -0.087156, -0.988769), abs(5.019853 - t)/1.000188);
	} else if(t >= 5.019853 && t < 6.036451) {
		p = mix(vec3(0.259124, -0.073665, -6.240429),vec3(0.254597, -0.073841, -5.631124), abs(6.036451 - t)/1.016598);
		d = mix(vec3(-0.017410, 0.069756, -0.997412),vec3(0.052286, -0.043619, -0.997679), abs(6.036451 - t)/1.016598);
	} else if(t >= 6.036451 && t < 7.052988) {
		p = mix(vec3(0.248513, -0.029095, -6.848306),vec3(0.259124, -0.073665, -6.240429), abs(7.052988 - t)/1.016537);
		d = mix(vec3(-0.017436, -0.043619, -0.998896),vec3(-0.017410, 0.069756, -0.997412), abs(7.052988 - t)/1.016537);
	} else if(t >= 7.052988 && t < 8.053700) {
		p = mix(vec3(0.248748, -0.096859, -7.444055),vec3(0.248513, -0.029095, -6.848306), abs(8.053700 - t)/1.000713);
		d = mix(vec3(0.008631, -0.147809, -0.988978),vec3(-0.017436, -0.043619, -0.998896), abs(8.053700 - t)/1.000713);
	} else if(t >= 8.053700 && t < 9.069512) {
		p = mix(vec3(0.263388, -0.193352, -8.046168),vec3(0.248748, -0.096859, -7.444055), abs(9.069512 - t)/1.015812);
		d = mix(vec3(0.017303, -0.130526, -0.991294),vec3(0.008631, -0.147809, -0.988978), abs(9.069512 - t)/1.015812);
	} else if(t >= 9.069512 && t < 10.070158) {
		p = mix(vec3(0.281033, -0.283510, -8.639175),vec3(0.263388, -0.193352, -8.046168), abs(10.070158 - t)/1.000646);
		d = mix(vec3(0.051541, -0.173648, -0.983458),vec3(0.017303, -0.130526, -0.991294), abs(10.070158 - t)/1.000646);
	} else if(t >= 10.070158 && t < 11.070646) {
		p = mix(vec3(0.324495, -0.383472, -9.228999),vec3(0.281033, -0.283510, -8.639175), abs(11.070646 - t)/1.000488);
		d = mix(vec3(0.051946, -0.121869, -0.991186),vec3(0.051541, -0.173648, -0.983458), abs(11.070646 - t)/1.000488);
	} else if(t >= 11.070646 && t < 12.086543) {
		p = mix(vec3(0.334139, -0.421164, -9.837506),vec3(0.324495, -0.383472, -9.228999), abs(12.086543 - t)/1.015897);
		d = mix(vec3(-0.017450, 0.017452, -0.999695),vec3(0.051946, -0.121869, -0.991186), abs(12.086543 - t)/1.015897);
	} else if(t >= 12.086543 && t < 13.087254) {
		p = mix(vec3(0.323676, -0.406073, -10.436934),vec3(0.334139, -0.421164, -9.837506), abs(13.087254 - t)/1.000710);
		d = mix(vec3(-0.017446, 0.026177, -0.999505),vec3(-0.017450, 0.017452, -0.999695), abs(13.087254 - t)/1.000710);
	} else if(t >= 13.087254 && t < 14.087498) {
		p = mix(vec3(0.323762, -0.403719, -11.037233),vec3(0.323676, -0.406073, -10.436934), abs(14.087498 - t)/1.000244);
		d = mix(vec3(0.017446, -0.026177, -0.999505),vec3(-0.017446, 0.026177, -0.999505), abs(14.087498 - t)/1.000244);
	} else if(t >= 14.087498 && t < 15.088168) {
		p = mix(vec3(0.338420, -0.422043, -11.637001),vec3(0.323762, -0.403719, -11.037233), abs(15.088168 - t)/1.000670);
		d = mix(vec3(0.052175, -0.078459, -0.995551),vec3(0.017446, -0.026177, -0.999505), abs(15.088168 - t)/1.000670);
	} else if(t >= 15.088168 && t < 16.104311) {
		p = mix(vec3(0.357469, -0.493619, -12.241601),vec3(0.338420, -0.422043, -11.637001), abs(16.104311 - t)/1.016143);
		d = mix(vec3(0.034560, -0.139173, -0.989665),vec3(0.052175, -0.078459, -0.995551), abs(16.104311 - t)/1.016143);
	} else if(t >= 16.104311 && t < 17.104815) {
		p = mix(vec3(0.376308, -0.597069, -12.832097),vec3(0.357469, -0.493619, -12.241601), abs(17.104815 - t)/1.000504);
		d = mix(vec3(0.008467, -0.241922, -0.970259),vec3(0.034560, -0.139173, -0.989665), abs(17.104815 - t)/1.000504);
	} else if(t >= 17.104815 && t < 18.121557) {
		p = mix(vec3(0.373514, -0.711138, -13.431056),vec3(0.376308, -0.597069, -12.832097), abs(18.121557 - t)/1.016743);
		d = mix(vec3(-0.078384, -0.043619, -0.995969),vec3(0.008467, -0.241922, -0.970259), abs(18.121557 - t)/1.016743);
	} else if(t >= 18.121557 && t < 19.138214) {
		p = mix(vec3(0.210832, -0.690646, -14.016356),vec3(0.373514, -0.711138, -13.431056), abs(19.138214 - t)/1.016657);
		d = mix(vec3(-0.366152, 0.043619, -0.929532),vec3(-0.078384, -0.043619, -0.995969), abs(19.138214 - t)/1.016657);
	} else if(t >= 19.138214 && t < 20.138716) {
		p = mix(vec3(-0.028783, -0.660362, -14.565328),vec3(0.210832, -0.690646, -14.016356), abs(20.138716 - t)/1.000502);
		d = mix(vec3(-0.476269, 0.061049, -0.877178),vec3(-0.366152, 0.043619, -0.929532), abs(20.138716 - t)/1.000502);
	} else if(t >= 20.138716 && t < 21.155252) {
		p = mix(vec3(-0.363798, -0.600619, -15.070217),vec3(-0.028783, -0.660362, -14.565328), abs(21.155252 - t)/1.016537);
		d = mix(vec3(-0.622408, 0.147809, -0.768610),vec3(-0.476269, 0.061049, -0.877178), abs(21.155252 - t)/1.016537);
	} else if(t >= 21.155252 && t < 22.171436) {
		p = mix(vec3(-0.743767, -0.499367, -15.534537),vec3(-0.363798, -0.600619, -15.070217), abs(22.171436 - t)/1.016184);
		d = mix(vec3(-0.480091, 0.139173, -0.866108),vec3(-0.622408, 0.147809, -0.768610), abs(22.171436 - t)/1.016184);
	} else if(t >= 22.171436 && t < 23.172539) {
		p = mix(vec3(-1.010265, -0.414756, -16.065735),vec3(-0.743767, -0.499367, -15.534537), abs(23.172539 - t)/1.001102);
		d = mix(vec3(-0.371814, 0.121869, -0.920273),vec3(-0.480091, 0.139173, -0.866108), abs(23.172539 - t)/1.001102);
	} else if(t >= 23.172539 && t < 24.188763) {
		p = mix(vec3(-1.174165, -0.336050, -16.647093),vec3(-1.010265, -0.414756, -16.065735), abs(24.188763 - t)/1.016224);
		d = mix(vec3(-0.162784, 0.165048, -0.972759),vec3(-0.371814, 0.121869, -0.920273), abs(24.188763 - t)/1.016224);
	} else if(t >= 24.188763 && t < 25.206181) {
		p = mix(vec3(-1.190971, -0.163701, -17.229149),vec3(-1.174165, -0.336050, -16.647093), abs(25.206181 - t)/1.017418);
		d = mix(vec3(0.056801, 0.366501, -0.928682),vec3(-0.162784, 0.165048, -0.972759), abs(25.206181 - t)/1.017418);
	} else if(t >= 25.206181 && t < 26.222019) {
		p = mix(vec3(-1.090793, 0.081912, -17.777052),vec3(-1.190971, -0.163701, -17.229149), abs(26.222019 - t)/1.015839);
		d = mix(vec3(0.264979, 0.422618, -0.866706),vec3(0.056801, 0.366501, -0.928682), abs(26.222019 - t)/1.015839);
	} else if(t >= 26.222019 && t < 27.238903) {
		p = mix(vec3(-0.890653, 0.338646, -18.291937),vec3(-1.090793, 0.081912, -17.777052), abs(27.238903 - t)/1.016884);
		d = mix(vec3(0.370115, 0.414693, -0.831291),vec3(0.264979, 0.422618, -0.866706), abs(27.238903 - t)/1.016884);
	} else if(t >= 27.238903 && t < 28.255907) {
		p = mix(vec3(-0.652101, 0.587595, -18.795214),vec3(-0.890653, 0.338646, -18.291937), abs(28.255907 - t)/1.017004);
		d = mix(vec3(0.400472, 0.406737, -0.821089),vec3(0.370115, 0.414693, -0.831291), abs(28.255907 - t)/1.017004);
	} else if(t >= 28.255907 && t < 29.256645) {
		p = mix(vec3(-0.355324, 0.826748, -19.258074),vec3(-0.652101, 0.587595, -18.795214), abs(29.256645 - t)/1.000738);
		d = mix(vec3(0.492529, 0.333807, -0.803734),vec3(0.400472, 0.406737, -0.821089), abs(29.256645 - t)/1.000738);
	} else if(t >= 29.256645 && t < 30.256742) {
		p = mix(vec3(-0.088239, 0.960891, -19.776548),vec3(-0.355324, 0.826748, -19.258074), abs(30.256742 - t)/1.000097);
		d = mix(vec3(0.408393, 0.173648, -0.896137),vec3(0.492529, 0.333807, -0.803734), abs(30.256742 - t)/1.000097);
	} else if(t >= 30.256742 && t < 31.272776) {
		p = mix(vec3(0.150850, 1.085115, -20.323627),vec3(-0.088239, 0.960891, -19.776548), abs(31.272776 - t)/1.016033);
		d = mix(vec3(0.385162, 0.258819, -0.885812),vec3(0.408393, 0.173648, -0.896137), abs(31.272776 - t)/1.016033);
	} else if(t >= 31.272776 && t < 32.289207) {
		p = mix(vec3(0.358841, 1.305939, -20.850304),vec3(0.150850, 1.085115, -20.323627), abs(32.289207 - t)/1.016432);
		d = mix(vec3(0.281453, 0.461749, -0.841173),vec3(0.385162, 0.258819, -0.885812), abs(32.289207 - t)/1.016432);
	} else if(t >= 32.289207 && t < 33.289726) {
		p = mix(vec3(0.527439, 1.598743, -21.346304),vec3(0.358841, 1.305939, -20.850304), abs(33.289726 - t)/1.000519);
		d = mix(vec3(0.264265, 0.477159, -0.838143),vec3(0.281453, 0.461749, -0.841173), abs(33.289726 - t)/1.000519);
	} else if(t >= 33.289726 && t < 34.289738) {
		p = mix(vec3(0.686786, 1.834502, -21.874411),vec3(0.527439, 1.598743, -21.346304), abs(34.289738 - t)/1.000011);
		d = mix(vec3(0.258182, 0.350207, -0.900387),vec3(0.264265, 0.477159, -0.838143), abs(34.289738 - t)/1.000011);
	} else if(t >= 34.289738 && t < 35.289913) {
		p = mix(vec3(0.843363, 2.004330, -22.427231),vec3(0.686786, 1.834502, -21.874411), abs(35.289913 - t)/1.000175);
		d = mix(vec3(0.259855, 0.233445, -0.937005),vec3(0.258182, 0.350207, -0.900387), abs(35.289913 - t)/1.000175);
	} else if(t >= 35.289913 && t < 36.290031) {
		p = mix(vec3(0.985748, 2.104356, -23.001114),vec3(0.843363, 2.004330, -22.427231), abs(36.290031 - t)/1.000118);
		d = mix(vec3(0.223915, 0.095846, -0.969884),vec3(0.259855, 0.233445, -0.937005), abs(36.290031 - t)/1.000118);
	} else if(t >= 36.290031 && t < 37.307171) {
		p = mix(vec3(1.103417, 2.139645, -23.597784),vec3(0.985748, 2.104356, -23.001114), abs(37.307171 - t)/1.017139);
		d = mix(vec3(0.138834, 0.069756, -0.987856),vec3(0.223915, 0.095846, -0.969884), abs(37.307171 - t)/1.017139);
	} else if(t >= 37.307171 && t < 38.307220) {
		p = mix(vec3(1.172607, 2.200056, -24.191170),vec3(1.103417, 2.139645, -23.597784), abs(38.307220 - t)/1.000050);
		d = mix(vec3(0.111651, 0.165048, -0.979946),vec3(0.138834, 0.069756, -0.987856), abs(38.307220 - t)/1.000050);
	} else if(t >= 38.307220 && t < 39.324493) {
		p = mix(vec3(1.257035, 2.355145, -24.773752),vec3(1.172607, 2.200056, -24.191170), abs(39.324493 - t)/1.017273);
		d = mix(vec3(0.173801, 0.300706, -0.937747),vec3(0.111651, 0.165048, -0.979946), abs(39.324493 - t)/1.017273);
	} else if(t >= 39.324493 && t < 40.340771) {
		p = mix(vec3(1.457353, 2.513439, -25.326130),vec3(1.257035, 2.355145, -24.773752), abs(40.340771 - t)/1.016277);
		d = mix(vec3(0.421103, 0.207912, -0.882862),vec3(0.173801, 0.300706, -0.937747), abs(40.340771 - t)/1.016277);
	} else if(t >= 40.340771 && t < 41.340908) {
		p = mix(vec3(1.734204, 2.582260, -25.852375),vec3(1.457353, 2.513439, -25.326130), abs(41.340908 - t)/1.000137);
		d = mix(vec3(0.484514, 0.034899, -0.874087),vec3(0.421103, 0.207912, -0.882862), abs(41.340908 - t)/1.000137);
	} else if(t >= 41.340908 && t < 42.358311) {
		p = mix(vec3(2.027395, 2.546074, -26.385036),vec3(1.734204, 2.582260, -25.852375), abs(42.358311 - t)/1.017403);
		d = mix(vec3(0.463033, -0.165048, -0.870839),vec3(0.484514, 0.034899, -0.874087), abs(42.358311 - t)/1.017403);
	} else if(t >= 42.358311 && t < 43.374634) {
		p = mix(vec3(2.262399, 2.381153, -26.921862),vec3(2.027395, 2.546074, -26.385036), abs(43.374634 - t)/1.016323);
		d = mix(vec3(0.318222, -0.366501, -0.874306),vec3(0.463033, -0.165048, -0.870839), abs(43.374634 - t)/1.016323);
	} else if(t >= 43.374634 && t < 44.391602) {
		p = mix(vec3(2.420227, 2.144034, -27.460186),vec3(2.262399, 2.381153, -26.921862), abs(44.391602 - t)/1.016968);
		d = mix(vec3(0.158636, -0.406737, -0.899667),vec3(0.318222, -0.366501, -0.874306), abs(44.391602 - t)/1.016968);
	} else if(t >= 44.391602 && t < 45.392040) {
		p = mix(vec3(2.409779, 1.906780, -28.009596),vec3(2.420227, 2.144034, -27.460186), abs(45.392040 - t)/1.000439);
		d = mix(vec3(-0.097586, -0.358368, -0.928466),vec3(0.158636, -0.406737, -0.899667), abs(45.392040 - t)/1.000439);
	} else if(t >= 45.392040 && t < 46.392220) {
		p = mix(vec3(2.358037, 1.720506, -28.577618),vec3(2.409779, 1.906780, -28.009596), abs(46.392220 - t)/1.000179);
		d = mix(vec3(-0.075420, -0.275637, -0.958298),vec3(-0.097586, -0.358368, -0.928466), abs(46.392220 - t)/1.000179);
	} else if(t >= 46.392220 && t < 47.408634) {
		p = mix(vec3(2.311585, 1.572885, -29.167860),vec3(2.358037, 1.720506, -28.577618), abs(47.408634 - t)/1.016415);
		d = mix(vec3(-0.076745, -0.207912, -0.975132),vec3(-0.075420, -0.275637, -0.958298), abs(47.408634 - t)/1.016415);
	} else if(t >= 47.408634 && t < 48.408882) {
		p = mix(vec3(2.279032, 1.470233, -29.758211),vec3(2.311585, 1.572885, -29.167860), abs(48.408882 - t)/1.000248);
		d = mix(vec3(-0.043195, -0.139173, -0.989326),vec3(-0.076745, -0.207912, -0.975132), abs(48.408882 - t)/1.000248);
	} else if(t >= 48.408882 && t < 49.409184) {
		p = mix(vec3(2.262027, 1.409882, -30.354712),vec3(2.279032, 1.470233, -29.758211), abs(49.409184 - t)/1.000301);
		d = mix(vec3(-0.017420, -0.061049, -0.997983),vec3(-0.043195, -0.139173, -0.989326), abs(49.409184 - t)/1.000301);
	} else if(t >= 49.409184 && t < 50.425064) {
		p = mix(vec3(2.260197, 1.396611, -30.964169),vec3(2.262027, 1.409882, -30.354712), abs(50.425064 - t)/1.015881);
		d = mix(vec3(-0.000000, -0.008727, -0.999962),vec3(-0.017420, -0.061049, -0.997983), abs(50.425064 - t)/1.015881);
	} else if(t >= 50.425064 && t < 51.426105) {
		p = mix(vec3(2.269207, 1.472721, -31.555370),vec3(2.260197, 1.396611, -30.964169), abs(51.426105 - t)/1.001041);
		d = mix(vec3(0.058381, 0.292372, -0.954521),vec3(-0.000000, -0.008727, -0.999962), abs(51.426105 - t)/1.001041);
	} else if(t >= 51.426105 && t < 52.443081) {
		p = mix(vec3(2.308979, 1.687434, -32.124588),vec3(2.269207, 1.472721, -31.555370), abs(52.443081 - t)/1.016975);
		d = mix(vec3(0.072222, 0.390731, -0.917667),vec3(0.058381, 0.292372, -0.954521), abs(52.443081 - t)/1.016975);
	} else if(t >= 52.443081 && t < 53.458740) {
		p = mix(vec3(2.355328, 1.936752, -32.680065),vec3(2.308979, 1.687434, -32.124588), abs(53.458740 - t)/1.015659);
		d = mix(vec3(0.079308, 0.414693, -0.906499),vec3(0.072222, 0.390731, -0.917667), abs(53.458740 - t)/1.015659);
	} else if(t >= 53.458740 && t < 54.459618) {
		p = mix(vec3(2.374439, 2.185572, -33.225403),vec3(2.355328, 1.936752, -32.680065), abs(54.459618 - t)/1.000877);
		d = mix(vec3(-0.031757, 0.414693, -0.909407),vec3(0.079308, 0.414693, -0.906499), abs(54.459618 - t)/1.000877);
	} else if(t >= 54.459618 && t < 55.476219) {
		p = mix(vec3(2.288514, 2.424050, -33.777962),vec3(2.374439, 2.185572, -33.225403), abs(55.476219 - t)/1.016602);
		d = mix(vec3(-0.258182, 0.350207, -0.900387),vec3(-0.031757, 0.414693, -0.909407), abs(55.476219 - t)/1.016602);
	} else if(t >= 55.476219 && t < 56.476486) {
		p = mix(vec3(2.072261, 2.593566, -34.309662),vec3(2.288514, 2.424050, -33.777962), abs(56.476486 - t)/1.000267);
		d = mix(vec3(-0.452479, 0.199368, -0.869204),vec3(-0.258182, 0.350207, -0.900387), abs(56.476486 - t)/1.000267);
	} else if(t >= 56.476486 && t < 57.476562) {
		p = mix(vec3(1.775821, 2.665611, -34.825230),vec3(2.072261, 2.593566, -34.309662), abs(57.476562 - t)/1.000076);
		d = mix(vec3(-0.536972, 0.034899, -0.842878),vec3(-0.452479, 0.199368, -0.869204), abs(57.476562 - t)/1.000076);
	} else if(t >= 57.476562 && t < 58.477230) {
		p = mix(vec3(1.451550, 2.617726, -35.324913),vec3(1.775821, 2.665611, -34.825230), abs(58.477230 - t)/1.000668);
		d = mix(vec3(-0.528461, -0.241922, -0.813758),vec3(-0.536972, 0.034899, -0.842878), abs(58.477230 - t)/1.000668);
	} else if(t >= 58.477230 && t < 59.493458) {
		p = mix(vec3(1.112304, 2.405359, -35.781662),vec3(1.451550, 2.617726, -35.324913), abs(59.493458 - t)/1.016228);
		d = mix(vec3(-0.575253, -0.446198, -0.685559),vec3(-0.528461, -0.241922, -0.813758), abs(59.493458 - t)/1.016228);
	} else if(t >= 59.493458 && t < 60.509735) {
		p = mix(vec3(0.761518, 2.112234, -36.185295),vec3(1.112304, 2.405359, -35.781662), abs(60.509735 - t)/1.016277);
		d = mix(vec3(-0.573846, -0.500000, -0.648615),vec3(-0.575253, -0.446198, -0.685559), abs(60.509735 - t)/1.016277);
	} else if(t >= 60.509735 && t < 61.509945) {
		p = mix(vec3(0.426134, 1.792186, -36.566902),vec3(0.761518, 2.112234, -36.185295), abs(61.509945 - t)/1.000210);
		d = mix(vec3(-0.538417, -0.559193, -0.630405),vec3(-0.573846, -0.500000, -0.648615), abs(61.509945 - t)/1.000210);
	} else if(t >= 61.509945 && t < 62.510227) {
		p = mix(vec3(0.112507, 1.453081, -36.948910),vec3(0.426134, 1.792186, -36.566902), abs(62.510227 - t)/1.000282);
		d = mix(vec3(-0.478152, -0.594823, -0.646186),vec3(-0.538417, -0.559193, -0.630405), abs(62.510227 - t)/1.000282);
	} else if(t >= 62.510227 && t < 63.510849) {
		p = mix(vec3(-0.138652, 1.081242, -37.346924),vec3(0.112507, 1.453081, -36.948910), abs(63.510849 - t)/1.000622);
		d = mix(vec3(-0.361368, -0.622515, -0.694182),vec3(-0.478152, -0.594823, -0.646186), abs(63.510849 - t)/1.000622);
	} else if(t >= 63.510849 && t < 64.527786) {
		p = mix(vec3(-0.217400, 0.721344, -37.824081),vec3(-0.138652, 1.081242, -37.346924), abs(64.527786 - t)/1.016937);
		d = mix(vec3(0.066897, -0.522499, -0.850012),vec3(-0.361368, -0.622515, -0.694182), abs(64.527786 - t)/1.016937);
	} else if(t >= 64.527786 && t < 65.528351) {
		p = mix(vec3(-0.186434, 0.464542, -38.362686),vec3(-0.217400, 0.721344, -37.824081), abs(65.528351 - t)/1.000565);
		d = mix(vec3(-0.024824, -0.317305, -0.947999),vec3(0.066897, -0.522499, -0.850012), abs(65.528351 - t)/1.000565);
	} else if(t >= 65.528351 && t < 66.543808) {
		p = mix(vec3(-0.281054, 0.334386, -38.950703),vec3(-0.186434, 0.464542, -38.362686), abs(66.543808 - t)/1.015457);
		d = mix(vec3(-0.136843, -0.182236, -0.973686),vec3(-0.024824, -0.317305, -0.947999), abs(66.543808 - t)/1.015457);
	} else if(t >= 66.543808 && t < 67.543930) {
		p = mix(vec3(-0.246817, 0.223264, -39.536400),vec3(-0.281054, 0.334386, -38.950703), abs(67.543930 - t)/1.000122);
		d = mix(vec3(0.170458, -0.190809, -0.966714),vec3(-0.136843, -0.182236, -0.973686), abs(67.543930 - t)/1.000122);
	} else if(t >= 67.543930 && t < 68.544212) {
		p = mix(vec3(-0.123088, 0.124300, -40.114655),vec3(-0.246817, 0.223264, -39.536400), abs(68.544212 - t)/1.000282);
		d = mix(vec3(0.239568, -0.139173, -0.960853),vec3(0.170458, -0.190809, -0.966714), abs(68.544212 - t)/1.000282);
	} else if(t >= 68.544212 && t < 69.544395) {
		p = mix(vec3(-0.004088, 0.063113, -40.699322),vec3(-0.123088, 0.124300, -40.114655), abs(69.544395 - t)/1.000183);
		d = mix(vec3(0.112992, -0.061049, -0.991719),vec3(0.239568, -0.139173, -0.960853), abs(69.544395 - t)/1.000183);
	} else if(t >= 69.544395 && t < 70.544418) {
		p = mix(vec3(0.026373, 0.040341, -41.298046),vec3(-0.004088, 0.063113, -40.699322), abs(70.544418 - t)/1.000023);
		d = mix(vec3(-0.000000, -0.026177, -0.999657),vec3(0.112992, -0.061049, -0.991719), abs(70.544418 - t)/1.000023);
	} else if(t >= 70.544418 && t < 71.544556) {
		p = mix(vec3(0.026373, 0.024644, -41.897480),vec3(0.026373, 0.040341, -41.298046), abs(71.544556 - t)/1.000137);
		d = mix(vec3(-0.000000, -0.026177, -0.999657),vec3(-0.000000, -0.026177, -0.999657), abs(71.544556 - t)/1.000137);
	}
}

void main() {
	vec2 uv = -1.0 + 2.0*(gl_FragCoord.xy/resolution);
	uv.x *= resolution.x/resolution.y;

	vec3 col = vec3(0);

	vec3 ro = vec3(0, 0, -3);
	vec3 ww = vec3(0, 0, 1);

	cameraPath(ro, ww, time);
	ww = normalize(ww);
	vec3 uu = normalize(cross(ww, vec3(0, 1, 0)));
	vec3 vv = normalize(cross(uu, ww));

	vec3 rd = normalize(uv.x*uu + uv.y*vv + 1.97*ww);

	vec2 i = march(ro, rd);
	if(i.x < tmax) {
		vec3 pos = ro + rd*i.x;
		vec3 nor = normal(pos);
		vec3 ref = reflect(rd, nor);

		vec3 key = normalize(vec3(0.8, 0.7, -0.6));
		vec3 gro = vec3(0, 1, 0);

		col  = 0.1*vec3(1);
		col += 0.9*clamp(dot(key, nor), 0.0, 1.0);
		col += 0.6*clamp(0.2 + 0.8*dot(-key, nor), 0.0, 1.0);
		col += 0.5*clamp(dot(gro, nor), 0.0, 1.0);

		vec3 mat = mix(vec3(1), vec3(0.3, 0.2, 0.2), clamp(2.0*(orb.x + orb.z), 0.0, 1.0));
		mat = mix(mat, vec3(0.5, 0.2, 0.3), clamp(0.5*orb.y, 0.0, 1.0));
		mat = mix(mat, vec3(0.2, 0.3, 0.5), orb.w);

		col *= mat;

		col += 0.3*pow(clamp(dot(key, ref), 0.0, 1.0), 16.0);
		col += 0.4*pow(clamp(1.0 + dot(rd, nor), 0.0, 1.0), 2.0);


		col *= ao(pos, nor);
	}

	col += vec3(pow(abs(i.y), 5.0))*vec3(1.00, 0.97, 0.3)*0.5;
	col = mix(col, vec3(1), 1.0 - exp(-0.1*i.x));
	col = sqrt(col);

	fragColor = vec4(col, 1);
}