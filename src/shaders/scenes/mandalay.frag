#version 330 core

out vec4 fragColor;

uniform vec2 resolution;
uniform float time;

const float tmax = 100.0;

float fold(vec3 p, float fo, float g) {
	if(p.z>p.y) p.yz = p.zy;

	vec2 v = p.xy - vec2(2, 4)*fo;

	float f = abs(max(v.x, v.y) + fo) - fo;
	f = min(f, max(v.x - g, p.y));

	return min(f, max(v.x + g, 2.0*fo - p.y));
}

void fold(inout vec3 p, vec3 fo, vec3 g) {
	vec3 q = p;
	p.x = fold(q, fo.x, g.x);
	p.y = fold(q.yzx, fo.y, g.y);
	p.z = fold(q.zxy, fo.z, g.z);
}

void rotate(inout vec2 p, float a) {
	float s = sin(a);
	float c = cos(a);

	p = mat2(c, s, -s, c)*p;
}

float cylinder(vec3 p, vec2 h) {
	vec2 d = abs(vec2(length(p.xy), p.z)) - h;
	return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
}

float mr = 0.05;
float de(vec3 p) {
	vec4 q = vec4(p, 1);
	vec4 o = q;

	float d = 10000.0;

	for(int i = 0; i < 6; i++) {
		q.xyz = abs(q.xyz);
		fold(q.xyz, vec3(3), vec3(2));

		q *= clamp(1.0/dot(q.xyz, q.xyz), 1.0, 1.0/mr);
		q = q*(3.0) + o;

		d = min(d, (length(q.xz))/q.w);
	}

	return d - 0.01;
}

// code generated in console.
void cameraPath(inout vec3 p, inout vec3 d, float t) {
	t = mod(t, 101.210983);
	if(t >= 0.000000 && t < 1.014134) {
		p = mix(vec3(-6.258072, 6.103697, -5.673536),vec3(-6.258072, 6.103697, -5.673536), abs(1.014134 - t)/1.014134);
		d = mix(vec3(-0.000000, 0.000000, -1.000000),vec3(0.000000, 0.000000, -1.000000), abs(1.014134 - t)/1.014134);
	} else if(t >= 1.014134 && t < 2.033905) {
		p = mix(vec3(-6.309613, 6.132466, -5.711131),vec3(-6.258072, 6.103697, -5.673536), abs(2.033905 - t)/1.019770);
		d = mix(vec3(-0.740814, 0.414693, -0.528417),vec3(-0.000000, 0.000000, -1.000000), abs(2.033905 - t)/1.019770);
	} else if(t >= 2.033905 && t < 3.067726) {
		p = mix(vec3(-6.930710, 6.331169, -5.940108),vec3(-6.309613, 6.132466, -5.711131), abs(3.067726 - t)/1.033822);
		d = mix(vec3(-0.426321, 0.139173, -0.893801),vec3(-0.740814, 0.414693, -0.528417), abs(3.067726 - t)/1.033822);
	} else if(t >= 3.067726 && t < 4.083551) {
		p = mix(vec3(-7.354634, 6.358003, -6.628397),vec3(-6.930710, 6.331169, -5.940108), abs(4.083551 - t)/1.015825);
		d = mix(vec3(0.694632, -0.008727, -0.719312),vec3(-0.426321, 0.139173, -0.893801), abs(4.083551 - t)/1.015825);
	} else if(t >= 4.083551 && t < 5.100453) {
		p = mix(vec3(-7.195406, 6.355556, -7.463757),vec3(-7.354634, 6.358003, -6.628397), abs(5.100453 - t)/1.016901);
		d = mix(vec3(0.961115, 0.017452, -0.275595),vec3(0.694632, -0.008727, -0.719312), abs(5.100453 - t)/1.016901);
	} else if(t >= 5.100453 && t < 6.102219) {
		p = mix(vec3(-6.579800, 6.375157, -8.028311),vec3(-7.195406, 6.355556, -7.463757), abs(6.102219 - t)/1.001766);
		d = mix(vec3(0.947999, 0.026177, 0.317196),vec3(0.961115, 0.017452, -0.275595), abs(6.102219 - t)/1.001766);
	} else if(t >= 6.102219 && t < 7.102280) {
		p = mix(vec3(-5.943637, 6.390879, -8.027358),vec3(-6.579800, 6.375157, -8.028311), abs(7.102280 - t)/1.000061);
		d = mix(vec3(0.942319, 0.026177, 0.333693),vec3(0.947999, 0.026177, 0.317196), abs(7.102280 - t)/1.000061);
	} else if(t >= 7.102280 && t < 8.114834) {
		p = mix(vec3(-5.348466, 6.419016, -8.082150),vec3(-5.943637, 6.390879, -8.027358), abs(8.114834 - t)/1.012554);
		d = mix(vec3(0.957506, 0.052336, -0.283626),vec3(0.942319, 0.026177, 0.333693), abs(8.114834 - t)/1.012554);
	} else if(t >= 8.114834 && t < 9.115967) {
		p = mix(vec3(-4.715306, 6.447337, -8.411730),vec3(-5.348466, 6.419016, -8.082150), abs(9.115967 - t)/1.001133);
		d = mix(vec3(0.856874, 0.026177, 0.514862),vec3(0.957506, 0.052336, -0.283626), abs(9.115967 - t)/1.001133);
	} else if(t >= 9.115967 && t < 10.131645) {
		p = mix(vec3(-4.151425, 6.463297, -8.160887),vec3(-4.715306, 6.447337, -8.411730), abs(10.131645 - t)/1.015678);
		d = mix(vec3(0.823844, 0.026177, 0.566212),vec3(0.856874, 0.026177, 0.514862), abs(10.131645 - t)/1.015678);
	} else if(t >= 10.131645 && t < 11.134490) {
		p = mix(vec3(-3.682412, 6.457535, -7.805066),vec3(-4.151425, 6.463297, -8.160887), abs(11.134490 - t)/1.002845);
		d = mix(vec3(0.624392, -0.190809, 0.757448),vec3(0.823844, 0.026177, 0.566212), abs(11.134490 - t)/1.002845);
	} else if(t >= 11.134490 && t < 12.134601) {
		p = mix(vec3(-3.293164, 6.366183, -7.387002),vec3(-3.682412, 6.457535, -7.805066), abs(12.134601 - t)/1.000111);
		d = mix(vec3(0.937940, -0.061049, 0.341382),vec3(0.624392, -0.190809, 0.757448), abs(12.134601 - t)/1.000111);
	} else if(t >= 12.134601 && t < 13.148894) {
		p = mix(vec3(-2.733946, 6.334683, -7.190613),vec3(-3.293164, 6.366183, -7.387002), abs(13.148894 - t)/1.014294);
		d = mix(vec3(0.095813, 0.026177, 0.995055),vec3(0.937940, -0.061049, 0.341382), abs(13.148894 - t)/1.014294);
	} else if(t >= 13.148894 && t < 14.184392) {
		p = mix(vec3(-2.835861, 6.335494, -6.590626),vec3(-2.733946, 6.334683, -7.190613), abs(14.184392 - t)/1.035498);
		d = mix(vec3(-0.207904, -0.008727, 0.978110),vec3(0.095813, 0.026177, 0.995055), abs(14.184392 - t)/1.035498);
	} else if(t >= 14.184392 && t < 15.203471) {
		p = mix(vec3(-2.964077, 6.330163, -5.993773),vec3(-2.835861, 6.335494, -6.590626), abs(15.203471 - t)/1.019079);
		d = mix(vec3(-0.284004, -0.008727, 0.958783),vec3(-0.207904, -0.008727, 0.978110), abs(15.203471 - t)/1.019079);
	} else if(t >= 15.203471 && t < 16.216513) {
		p = mix(vec3(-3.310667, 6.313870, -5.491247),vec3(-2.964077, 6.330163, -5.993773), abs(16.216513 - t)/1.013041);
		d = mix(vec3(-0.742126, -0.052336, 0.668214),vec3(-0.284004, -0.008727, 0.958783), abs(16.216513 - t)/1.013041);
	} else if(t >= 16.216513 && t < 17.217133) {
		p = mix(vec3(-3.887684, 6.409299, -5.276882),vec3(-3.310667, 6.313870, -5.491247), abs(17.217133 - t)/1.000620);
		d = mix(vec3(-0.965190, -0.182236, 0.187614),vec3(-0.742126, -0.052336, 0.668214), abs(17.217133 - t)/1.000620);
	} else if(t >= 17.217133 && t < 18.232830) {
		p = mix(vec3(-4.395608, 6.217578, -5.543802),vec3(-3.887684, 6.409299, -5.276882), abs(18.232830 - t)/1.015697);
		d = mix(vec3(-0.959865, -0.250380, 0.126369),vec3(-0.965190, -0.182236, 0.187614), abs(18.232830 - t)/1.015697);
	} else if(t >= 18.232830 && t < 19.235207) {
		p = mix(vec3(-4.926169, 6.276808, -5.347292),vec3(-4.395608, 6.217578, -5.543802), abs(19.235207 - t)/1.002377);
		d = mix(vec3(-0.837970, 0.113203, 0.533846),vec3(-0.959865, -0.250380, 0.126369), abs(19.235207 - t)/1.002377);
	} else if(t >= 19.235207 && t < 20.270033) {
		p = mix(vec3(-5.490207, 6.258802, -5.092191),vec3(-4.926169, 6.276808, -5.347292), abs(20.270033 - t)/1.034826);
		d = mix(vec3(-0.936530, -0.017452, 0.350154),vec3(-0.837970, 0.113203, 0.533846), abs(20.270033 - t)/1.034826);
	} else if(t >= 20.270033 && t < 21.301468) {
		p = mix(vec3(-6.099409, 6.273267, -4.998527),vec3(-5.490207, 6.258802, -5.092191), abs(21.301468 - t)/1.031435);
		d = mix(vec3(-0.999619, -0.008727, 0.026176),vec3(-0.936530, -0.017452, 0.350154), abs(21.301468 - t)/1.031435);
	} else if(t >= 21.301468 && t < 22.302158) {
		p = mix(vec3(-6.697640, 6.261178, -5.014318),vec3(-6.099409, 6.273267, -4.998527), abs(22.302158 - t)/1.000690);
		d = mix(vec3(-0.949283, -0.061049, -0.308441),vec3(-0.999619, -0.008727, 0.026176), abs(22.302158 - t)/1.000690);
	} else if(t >= 22.302158 && t < 23.303053) {
		p = mix(vec3(-7.130101, 6.196012, -5.395281),vec3(-6.697640, 6.261178, -5.014318), abs(23.303053 - t)/1.000895);
		d = mix(vec3(-0.723320, -0.147809, -0.674507),vec3(-0.949283, -0.061049, -0.308441), abs(23.303053 - t)/1.000895);
	} else if(t >= 23.303053 && t < 24.336687) {
		p = mix(vec3(-7.427687, 6.260342, -5.015962),vec3(-7.130101, 6.196012, -5.395281), abs(24.336687 - t)/1.033634);
		d = mix(vec3(-0.043294, -0.121869, 0.991601),vec3(-0.723320, -0.147809, -0.674507), abs(24.336687 - t)/1.033634);
	} else if(t >= 24.336687 && t < 25.350393) {
		p = mix(vec3(-7.516297, 6.554085, -4.331246),vec3(-7.427687, 6.260342, -5.015962), abs(25.350393 - t)/1.013706);
		d = mix(vec3(0.119423, -0.199368, 0.972620),vec3(-0.043294, -0.121869, 0.991601), abs(25.350393 - t)/1.013706);
	} else if(t >= 25.350393 && t < 26.350445) {
		p = mix(vec3(-7.387140, 6.699527, -3.719636),vec3(-7.516297, 6.554085, -4.331246), abs(26.350445 - t)/1.000051);
		d = mix(vec3(0.706783, -0.224951, 0.670712),vec3(0.119423, -0.199368, 0.972620), abs(26.350445 - t)/1.000051);
	} else if(t >= 26.350445 && t < 27.351419) {
		p = mix(vec3(-6.883152, 6.569209, -3.425395),vec3(-7.387140, 6.699527, -3.719636), abs(27.351419 - t)/1.000975);
		d = mix(vec3(0.864101, -0.182236, 0.469169),vec3(0.706783, -0.224951, 0.670712), abs(27.351419 - t)/1.000975);
	} else if(t >= 27.351419 && t < 28.386322) {
		p = mix(vec3(-6.306926, 6.451040, -3.257915),vec3(-6.883152, 6.569209, -3.425395), abs(28.386322 - t)/1.034903);
		d = mix(vec3(0.914468, -0.165048, 0.369469),vec3(0.864101, -0.182236, 0.469169), abs(28.386322 - t)/1.034903);
	} else if(t >= 28.386322 && t < 29.403713) {
		p = mix(vec3(-5.470090, 6.421963, -3.302063),vec3(-6.306926, 6.451040, -3.257915), abs(29.403713 - t)/1.017391);
		d = mix(vec3(0.442872, -0.121869, 0.888264),vec3(0.914468, -0.165048, 0.369469), abs(29.403713 - t)/1.017391);
	} else if(t >= 29.403713 && t < 30.417946) {
		p = mix(vec3(-4.791167, 6.657024, -2.706705),vec3(-5.470090, 6.421963, -3.302063), abs(30.417946 - t)/1.014233);
		d = mix(vec3(-0.094390, -0.173648, 0.980274),vec3(0.442872, -0.121869, 0.888264), abs(30.417946 - t)/1.014233);
	} else if(t >= 30.417946 && t < 31.418507) {
		p = mix(vec3(-5.321511, 6.563966, -2.167478),vec3(-4.791167, 6.657024, -2.706705), abs(31.418507 - t)/1.000561);
		d = mix(vec3(0.069690, -0.043619, 0.996615),vec3(-0.094390, -0.173648, 0.980274), abs(31.418507 - t)/1.000561);
	} else if(t >= 31.418507 && t < 32.435467) {
		p = mix(vec3(-5.300140, 6.435977, -1.575965),vec3(-5.321511, 6.563966, -2.167478), abs(32.435467 - t)/1.016960);
		d = mix(vec3(0.008323, -0.300706, 0.953681),vec3(0.069690, -0.043619, 0.996615), abs(32.435467 - t)/1.016960);
	} else if(t >= 32.435467 && t < 33.454597) {
		p = mix(vec3(-5.295004, 6.337359, -0.987419),vec3(-5.300140, 6.435977, -1.575965), abs(33.454597 - t)/1.019131);
		d = mix(vec3(0.008726, -0.008727, 0.999924),vec3(0.008323, -0.300706, 0.953681), abs(33.454597 - t)/1.019131);
	} else if(t >= 33.454597 && t < 34.468830) {
		p = mix(vec3(-5.285075, 6.379673, -0.368453),vec3(-5.295004, 6.337359, -0.987419), abs(34.468830 - t)/1.014233);
		d = mix(vec3(0.034767, 0.087156, 0.995588),vec3(0.008726, -0.008727, 0.999924), abs(34.468830 - t)/1.014233);
	} else if(t >= 34.468830 && t < 35.469193) {
		p = mix(vec3(-5.259806, 6.425566, 0.228457),vec3(-5.285075, 6.379673, -0.368453), abs(35.469193 - t)/1.000362);
		d = mix(vec3(0.052238, 0.061049, 0.996767),vec3(0.034767, 0.087156, 0.995588), abs(35.469193 - t)/1.000362);
	} else if(t >= 35.469193 && t < 36.504532) {
		p = mix(vec3(-5.231807, 6.432361, 0.837698),vec3(-5.259806, 6.425566, 0.228457), abs(36.504532 - t)/1.035339);
		d = mix(vec3(0.034899, 0.000000, 0.999391),vec3(0.052238, 0.061049, 0.996767), abs(36.504532 - t)/1.035339);
	} else if(t >= 36.504532 && t < 37.518608) {
		p = mix(vec3(-5.232137, 6.450764, 1.457391),vec3(-5.231807, 6.432361, 0.837698), abs(37.518608 - t)/1.014076);
		d = mix(vec3(-0.026141, 0.052336, 0.998287),vec3(0.034899, 0.000000, 0.999391), abs(37.518608 - t)/1.014076);
	} else if(t >= 37.518608 && t < 38.519119) {
		p = mix(vec3(-5.254271, 6.472928, 2.056447),vec3(-5.232137, 6.450764, 1.457391), abs(38.519119 - t)/1.000511);
		d = mix(vec3(-0.061048, 0.000000, 0.998135),vec3(-0.026141, 0.052336, 0.998287), abs(38.519119 - t)/1.000511);
	} else if(t >= 38.519119 && t < 39.519794) {
		p = mix(vec3(-5.288486, 6.468305, 2.655734),vec3(-5.254271, 6.472928, 2.056447), abs(39.519794 - t)/1.000675);
		d = mix(vec3(-0.052328, -0.017452, 0.998477),vec3(-0.061048, 0.000000, 0.998135), abs(39.519794 - t)/1.000675);
	} else if(t >= 39.519794 && t < 40.535885) {
		p = mix(vec3(-5.284922, 6.454512, 3.265390),vec3(-5.288486, 6.468305, 2.655734), abs(40.535885 - t)/1.016090);
		d = mix(vec3(0.061028, -0.026177, 0.997793),vec3(-0.052328, -0.017452, 0.998477), abs(40.535885 - t)/1.016090);
	} else if(t >= 40.535885 && t < 41.571697) {
		p = mix(vec3(-5.230585, 6.439337, 3.872480),vec3(-5.284922, 6.454512, 3.265390), abs(41.571697 - t)/1.035812);
		d = mix(vec3(0.095831, -0.017452, 0.995245),vec3(0.061028, -0.026177, 0.997793), abs(41.571697 - t)/1.035812);
	} else if(t >= 41.571697 && t < 42.586754) {
		p = mix(vec3(-5.162240, 6.435929, 4.489260),vec3(-5.230585, 6.439337, 3.872480), abs(42.586754 - t)/1.015057);
		d = mix(vec3(0.147804, -0.008727, 0.988978),vec3(0.095831, -0.017452, 0.995245), abs(42.586754 - t)/1.015057);
	} else if(t >= 42.586754 && t < 43.586922) {
		p = mix(vec3(-5.064686, 6.626481, 5.099421),vec3(-5.162240, 6.435929, 4.489260), abs(43.586922 - t)/1.000168);
		d = mix(vec3(0.163016, -0.156434, 0.974143),vec3(0.147804, -0.008727, 0.988978), abs(43.586922 - t)/1.000168);
	} else if(t >= 43.586922 && t < 44.586956) {
		p = mix(vec3(-5.011646, 6.502439, 5.677431),vec3(-5.064686, 6.626481, 5.099421), abs(44.586956 - t)/1.000034);
		d = mix(vec3(-0.214888, -0.390731, 0.895071),vec3(0.163016, -0.156434, 0.974143), abs(44.586956 - t)/1.000034);
	} else if(t >= 44.586956 && t < 45.603611) {
		p = mix(vec3(-4.929118, 6.074922, 6.167796),vec3(-5.011646, 6.502439, 5.677431), abs(45.603611 - t)/1.016655);
		d = mix(vec3(-0.765436, -0.529919, -0.365094),vec3(-0.214888, -0.390731, 0.895071), abs(45.603611 - t)/1.016655);
	} else if(t >= 45.603611 && t < 46.604343) {
		p = mix(vec3(-5.102553, 5.569633, 6.798871),vec3(-4.929118, 6.074922, 6.167796), abs(46.604343 - t)/1.000732);
		d = mix(vec3(-0.380749, -0.544639, -0.747261),vec3(-0.765436, -0.529919, -0.365094), abs(46.604343 - t)/1.000732);
	} else if(t >= 46.604343 && t < 47.621075) {
		p = mix(vec3(-5.411137, 4.933199, 7.071974),vec3(-5.102553, 5.569633, 6.798871), abs(47.621075 - t)/1.016731);
		d = mix(vec3(-0.184269, -0.573576, -0.798157),vec3(-0.380749, -0.544639, -0.747261), abs(47.621075 - t)/1.016731);
	} else if(t >= 47.621075 && t < 48.637917) {
		p = mix(vec3(-5.829666, 4.081572, 7.029728),vec3(-5.411137, 4.933199, 7.071974), abs(48.637917 - t)/1.016842);
		d = mix(vec3(-0.138408, -0.688355, -0.712047),vec3(-0.184269, -0.573576, -0.798157), abs(48.637917 - t)/1.016842);
	} else if(t >= 48.637917 && t < 49.638302) {
		p = mix(vec3(-5.829589, 3.232884, 7.032666),vec3(-5.829666, 4.081572, 7.029728), abs(49.638302 - t)/1.000385);
		d = mix(vec3(-0.083889, -0.725374, -0.683224),vec3(-0.138408, -0.688355, -0.712047), abs(49.638302 - t)/1.000385);
	} else if(t >= 49.638302 && t < 50.673679) {
		p = mix(vec3(-5.825661, 2.370974, 7.075541),vec3(-5.829589, 3.232884, 7.032666), abs(50.673679 - t)/1.035378);
		d = mix(vec3(-0.058319, -0.743145, -0.666584),vec3(-0.083889, -0.725374, -0.683224), abs(50.673679 - t)/1.035378);
	} else if(t >= 50.673679 && t < 51.688126) {
		p = mix(vec3(-5.821663, 1.495708, 7.121241),vec3(-5.825661, 2.370974, 7.075541), abs(51.688126 - t)/1.014446);
		d = mix(vec3(-0.058319, -0.743145, -0.666584),vec3(-0.058319, -0.743145, -0.666584), abs(51.688126 - t)/1.014446);
	} else if(t >= 51.688126 && t < 52.704067) {
		p = mix(vec3(-5.817760, 0.636784, 7.199949),vec3(-5.821663, 1.495708, 7.121241), abs(52.704067 - t)/1.015942);
		d = mix(vec3(-0.021726, -0.782608, -0.622135),vec3(-0.058319, -0.743145, -0.666584), abs(52.704067 - t)/1.015942);
	} else if(t >= 52.704067 && t < 53.704365) {
		p = mix(vec3(-5.456420, -0.209921, 7.240656),vec3(-5.817760, 0.636784, 7.199949), abs(53.704365 - t)/1.000298);
		d = mix(vec3(-0.080742, -0.700909, -0.708666),vec3(-0.021726, -0.782608, -0.622135), abs(53.704365 - t)/1.000298);
	} else if(t >= 53.704365 && t < 54.706215) {
		p = mix(vec3(-5.289052, -1.041361, 7.144747),vec3(-5.456420, -0.209921, 7.240656), abs(54.706215 - t)/1.001850);
		d = mix(vec3(-0.082369, -0.615662, -0.783694),vec3(-0.080742, -0.700909, -0.708666), abs(54.706215 - t)/1.001850);
	} else if(t >= 54.706215 && t < 55.721222) {
		p = mix(vec3(-5.281408, -1.824279, 6.969823),vec3(-5.289052, -1.041361, 7.144747), abs(55.721222 - t)/1.015007);
		d = mix(vec3(0.048433, -0.608761, -0.791874),vec3(-0.082369, -0.615662, -0.783694), abs(55.721222 - t)/1.015007);
	} else if(t >= 55.721222 && t < 56.721287) {
		p = mix(vec3(-5.185812, -2.266359, 6.553282),vec3(-5.281408, -1.824279, 6.969823), abs(56.721287 - t)/1.000065);
		d = mix(vec3(0.049701, -0.580703, -0.812597),vec3(0.048433, -0.608761, -0.791874), abs(56.721287 - t)/1.000065);
	} else if(t >= 56.721287 && t < 57.721428) {
		p = mix(vec3(-5.159726, -2.625950, 6.075375),vec3(-5.185812, -2.266359, 6.553282), abs(57.721428 - t)/1.000141);
		d = mix(vec3(0.045994, -0.477159, -0.877613),vec3(0.049701, -0.580703, -0.812597), abs(57.721428 - t)/1.000141);
	} else if(t >= 57.721428 && t < 58.722095) {
		p = mix(vec3(-5.019500, -2.856563, 5.525889),vec3(-5.159726, -2.625950, 6.075375), abs(58.722095 - t)/1.000668);
		d = mix(vec3(0.016501, -0.325568, -0.945375),vec3(0.045994, -0.477159, -0.877613), abs(58.722095 - t)/1.000668);
	} else if(t >= 58.722095 && t < 59.722919) {
		p = mix(vec3(-5.022857, -3.011688, 4.946611),vec3(-5.019500, -2.856563, 5.525889), abs(59.722919 - t)/1.000824);
		d = mix(vec3(-0.059927, -0.190809, -0.979796),vec3(0.016501, -0.325568, -0.945375), abs(59.722919 - t)/1.000824);
	} else if(t >= 59.722919 && t < 60.738537) {
		p = mix(vec3(-5.121495, -3.092010, 4.352119),vec3(-5.022857, -3.011688, 4.946611), abs(60.738537 - t)/1.015617);
		d = mix(vec3(-0.266221, -0.087156, -0.959964),vec3(-0.059927, -0.190809, -0.979796), abs(60.738537 - t)/1.015617);
	} else if(t >= 60.738537 && t < 61.738796) {
		p = mix(vec3(-5.246283, -3.142101, 3.768504),vec3(-5.121495, -3.092010, 4.352119), abs(61.738796 - t)/1.000259);
		d = mix(vec3(-0.034767, -0.087156, -0.995588),vec3(-0.266221, -0.087156, -0.959964), abs(61.738796 - t)/1.000259);
	} else if(t >= 61.738796 && t < 62.739159) {
		p = mix(vec3(-5.197335, -3.190319, 3.172941),vec3(-5.246283, -3.142101, 3.768504), abs(62.739159 - t)/1.000362);
		d = mix(vec3(0.130208, -0.069756, -0.989030),vec3(-0.034767, -0.087156, -0.995588), abs(62.739159 - t)/1.000362);
	} else if(t >= 62.739159 && t < 63.739563) {
		p = mix(vec3(-5.110422, -3.229865, 2.581311),vec3(-5.197335, -3.190319, 3.172941), abs(63.739563 - t)/1.000404);
		d = mix(vec3(0.156143, -0.061049, -0.985846),vec3(0.130208, -0.069756, -0.989030), abs(63.739563 - t)/1.000404);
	} else if(t >= 63.739563 && t < 64.740273) {
		p = mix(vec3(-5.027695, -3.266567, 1.987102),vec3(-5.110422, -3.229865, 2.581311), abs(64.740273 - t)/1.000710);
		d = mix(vec3(0.095667, -0.061049, -0.993540),vec3(0.156143, -0.061049, -0.985846), abs(64.740273 - t)/1.000710);
	} else if(t >= 64.740273 && t < 65.776306) {
		p = mix(vec3(-5.026247, -3.293499, 1.379076),vec3(-5.027695, -3.266567, 1.987102), abs(65.776306 - t)/1.036034);
		d = mix(vec3(-0.078447, -0.017452, -0.996765),vec3(0.095667, -0.061049, -0.993540), abs(65.776306 - t)/1.036034);
	} else if(t >= 65.776306 && t < 66.790482) {
		p = mix(vec3(-5.067889, -3.278666, 0.761301),vec3(-5.026247, -3.293499, 1.379076), abs(66.790482 - t)/1.014175);
		d = mix(vec3(-0.043578, 0.043619, -0.998097),vec3(-0.078447, -0.017452, -0.996765), abs(66.790482 - t)/1.014175);
	} else if(t >= 66.790482 && t < 67.806931) {
		p = mix(vec3(-4.780279, -3.243053, 0.281895),vec3(-5.067889, -3.278666, 0.761301), abs(67.806931 - t)/1.016449);
		d = mix(vec3(0.880750, 0.199368, -0.429571),vec3(-0.043578, 0.043619, -0.998097), abs(67.806931 - t)/1.016449);
	} else if(t >= 67.806931 && t < 68.807114) {
		p = mix(vec3(-4.295764, -2.901699, 0.191650),vec3(-4.780279, -3.243053, 0.281895), abs(68.807114 - t)/1.000183);
		d = mix(vec3(0.700519, 0.669131, -0.248067),vec3(0.880750, 0.199368, -0.429571), abs(68.807114 - t)/1.000183);
	} else if(t >= 68.807114 && t < 69.807663) {
		p = mix(vec3(-3.994961, -2.406716, 0.100506),vec3(-4.295764, -2.901699, 0.191650), abs(69.807663 - t)/1.000549);
		d = mix(vec3(0.325894, 0.942641, -0.072249),vec3(0.700519, 0.669131, -0.248067), abs(69.807663 - t)/1.000549);
	} else if(t >= 69.807663 && t < 70.823158) {
		p = mix(vec3(-3.838366, -1.819046, 0.078463),vec3(-3.994961, -2.406716, 0.100506), abs(70.823158 - t)/1.015495);
		d = mix(vec3(0.240808, 0.970296, -0.023187),vec3(0.325894, 0.942641, -0.072249), abs(70.823158 - t)/1.015495);
	} else if(t >= 70.823158 && t < 71.823959) {
		p = mix(vec3(-3.752649, -1.226596, 0.068149),vec3(-3.838366, -1.819046, 0.078463), abs(71.823959 - t)/1.000801);
		d = mix(vec3(0.024896, 0.999657, -0.008089),vec3(0.240808, 0.970296, -0.023187), abs(71.823959 - t)/1.000801);
	} else if(t >= 71.823959 && t < 72.841179) {
		p = mix(vec3(-3.705979, -0.616870, 0.167132),vec3(-3.752649, -1.226596, 0.068149), abs(72.841179 - t)/1.017220);
		d = mix(vec3(0.014960, 0.999848, -0.008989),vec3(0.024896, 0.999657, -0.008089), abs(72.841179 - t)/1.017220);
	} else if(t >= 72.841179 && t < 73.857162) {
		p = mix(vec3(-3.697165, -0.006690, 0.161183),vec3(-3.705979, -0.616870, 0.167132), abs(73.857162 - t)/1.015984);
		d = mix(vec3(0.013369, 0.999848, -0.011218),vec3(0.014960, 0.999848, -0.008989), abs(73.857162 - t)/1.015984);
	} else if(t >= 73.857162 && t < 74.875961) {
		p = mix(vec3(-3.685145, 0.592933, 0.148332),vec3(-3.697165, -0.006690, 0.161183), abs(74.875961 - t)/1.018799);
		d = mix(vec3(0.022665, 0.999391, -0.026538),vec3(0.013369, 0.999848, -0.011218), abs(74.875961 - t)/1.018799);
	} else if(t >= 74.875961 && t < 75.891251) {
		p = mix(vec3(-3.669078, 1.212981, 0.127437),vec3(-3.685145, 0.592933, 0.148332), abs(75.891251 - t)/1.015289);
		d = mix(vec3(0.035016, 0.998135, -0.050008),vec3(0.022665, 0.999391, -0.026538), abs(75.891251 - t)/1.015289);
	} else if(t >= 75.891251 && t < 76.908035) {
		p = mix(vec3(-3.619466, 1.813050, 0.051107),vec3(-3.669078, 1.212981, 0.127437), abs(76.908035 - t)/1.016785);
		d = mix(vec3(0.139063, 0.965926, -0.218286),vec3(0.035016, 0.998135, -0.050008), abs(76.908035 - t)/1.016785);
	} else if(t >= 76.908035 && t < 77.908058) {
		p = mix(vec3(-3.517171, 2.487410, -0.102042),vec3(-3.619466, 1.813050, 0.051107), abs(77.908058 - t)/1.000023);
		d = mix(vec3(0.496078, 0.438371, -0.749492),vec3(0.139063, 0.965926, -0.218286), abs(77.908058 - t)/1.000023);
	} else if(t >= 77.908058 && t < 78.924812) {
		p = mix(vec3(-3.351596, 3.088486, 0.070393),vec3(-3.517171, 2.487410, -0.102042), abs(78.924812 - t)/1.016754);
		d = mix(vec3(0.173589, 0.026177, -0.984470),vec3(0.496078, 0.438371, -0.749492), abs(78.924812 - t)/1.016754);
	} else if(t >= 78.924812 && t < 79.960205) {
		p = mix(vec3(-3.411066, 3.636302, 0.290587),vec3(-3.351596, 3.088486, 0.070393), abs(79.960205 - t)/1.035393);
		d = mix(vec3(0.132734, 0.891007, -0.434153),vec3(0.173589, 0.026177, -0.984470), abs(79.960205 - t)/1.035393);
	} else if(t >= 79.960205 && t < 80.975555) {
		p = mix(vec3(-3.362593, 4.246209, 0.128256),vec3(-3.411066, 3.636302, 0.290587), abs(80.975555 - t)/1.015350);
		d = mix(vec3(0.110974, 0.920505, -0.374641),vec3(0.132734, 0.891007, -0.434153), abs(80.975555 - t)/1.015350);
	} else if(t >= 80.975555 && t < 81.975693) {
		p = mix(vec3(-3.366701, 4.860283, 0.132973),vec3(-3.362593, 4.246209, 0.128256), abs(81.975693 - t)/1.000137);
		d = mix(vec3(0.072139, 0.972370, -0.222020),vec3(0.110974, 0.920505, -0.374641), abs(81.975693 - t)/1.000137);
	} else if(t >= 81.975693 && t < 83.010971) {
		p = mix(vec3(-3.391151, 5.532812, 0.224123),vec3(-3.366701, 4.860283, 0.132973), abs(83.010971 - t)/1.035278);
		d = mix(vec3(0.069801, 0.894934, -0.440704),vec3(0.072139, 0.972370, -0.222020), abs(83.010971 - t)/1.035278);
	} else if(t >= 83.010971 && t < 84.025352) {
		p = mix(vec3(-3.355685, 6.146669, -0.087521),vec3(-3.391151, 5.532812, 0.224123), abs(84.025352 - t)/1.014381);
		d = mix(vec3(0.024965, 0.300706, -0.953390),vec3(0.069801, 0.894934, -0.440704), abs(84.025352 - t)/1.014381);
	} else if(t >= 84.025352 && t < 85.062630) {
		p = mix(vec3(-3.162338, 6.601228, -0.593917),vec3(-3.355685, 6.146669, -0.087521), abs(85.062630 - t)/1.037277);
		d = mix(vec3(-0.086198, 0.147809, -0.985252),vec3(0.024965, 0.300706, -0.953390), abs(85.062630 - t)/1.037277);
	} else if(t >= 85.062630 && t < 86.076347) {
		p = mix(vec3(-3.214802, 7.056684, -1.168431),vec3(-3.162338, 6.601228, -0.593917), abs(86.076347 - t)/1.013718);
		d = mix(vec3(-0.113048, 0.052336, -0.992210),vec3(-0.086198, 0.147809, -0.985252), abs(86.076347 - t)/1.013718);
	} else if(t >= 86.076347 && t < 87.094200) {
		p = mix(vec3(-3.007669, 7.175037, -1.920661),vec3(-3.214802, 7.056684, -1.168431), abs(87.094200 - t)/1.017853);
		d = mix(vec3(-0.685131, -0.165048, -0.709475),vec3(-0.113048, 0.052336, -0.992210), abs(87.094200 - t)/1.017853);
	} else if(t >= 87.094200 && t < 88.094933) {
		p = mix(vec3(-3.158870, 7.070939, -2.735013),vec3(-3.007669, 7.175037, -1.920661), abs(88.094933 - t)/1.000732);
		d = mix(vec3(-0.952679, -0.165048, -0.255270),vec3(-0.685131, -0.165048, -0.709475), abs(88.094933 - t)/1.000732);
	} else if(t >= 88.094933 && t < 89.109329) {
		p = mix(vec3(-3.740550, 6.968668, -2.949379),vec3(-3.158870, 7.070939, -2.735013), abs(89.109329 - t)/1.014397);
		d = mix(vec3(-0.985685, -0.165048, 0.034421),vec3(-0.952679, -0.165048, -0.255270), abs(89.109329 - t)/1.014397);
	} else if(t >= 89.109329 && t < 90.109612) {
		p = mix(vec3(-4.415790, 6.863561, -2.781015),vec3(-3.740550, 6.968668, -2.949379), abs(90.109612 - t)/1.000282);
		d = mix(vec3(-0.759361, -0.241922, -0.604023),vec3(-0.985685, -0.165048, 0.034421), abs(90.109612 - t)/1.000282);
	} else if(t >= 90.109612 && t < 91.110313) {
		p = mix(vec3(-4.877117, 6.733827, -3.122765),vec3(-4.415790, 6.863561, -2.781015), abs(91.110313 - t)/1.000702);
		d = mix(vec3(-0.390744, -0.199368, -0.898650),vec3(-0.759361, -0.241922, -0.604023), abs(91.110313 - t)/1.000702);
	} else if(t >= 91.110313 && t < 92.110313) {
		p = mix(vec3(-5.105309, 6.942014, -3.734216),vec3(-4.877117, 6.733827, -3.122765), abs(92.110313 - t)/1.000000);
		d = mix(vec3(-0.323891, -0.241922, -0.914641),vec3(-0.390744, -0.199368, -0.898650), abs(92.110313 - t)/1.000000);
	} else if(t >= 92.110313 && t < 93.127029) {
		p = mix(vec3(-4.861802, 6.738544, -4.377592),vec3(-5.105309, 6.942014, -3.734216), abs(93.127029 - t)/1.016716);
		d = mix(vec3(-0.426451, -0.500000, -0.753750),vec3(-0.323891, -0.241922, -0.914641), abs(93.127029 - t)/1.016716);
	} else if(t >= 93.127029 && t < 94.143059) {
		p = mix(vec3(-5.234527, 6.471690, -4.779070),vec3(-4.861802, 6.738544, -4.377592), abs(94.143059 - t)/1.016029);
		d = mix(vec3(-0.635957, -0.382683, -0.670159),vec3(-0.426451, -0.500000, -0.753750), abs(94.143059 - t)/1.016029);
	} else if(t >= 94.143059 && t < 95.161469) {
		p = mix(vec3(-5.594085, 6.254819, -5.206275),vec3(-5.234527, 6.471690, -4.779070), abs(95.161469 - t)/1.018410);
		d = mix(vec3(-0.545682, -0.342020, -0.765018),vec3(-0.635957, -0.382683, -0.670159), abs(95.161469 - t)/1.018410);
	} else if(t >= 95.161469 && t < 96.176956) {
		p = mix(vec3(-5.946074, 6.055099, -5.675757),vec3(-5.594085, 6.254819, -5.206275), abs(96.176956 - t)/1.015488);
		d = mix(vec3(-0.604946, -0.309017, -0.733859),vec3(-0.545682, -0.342020, -0.765018), abs(96.176956 - t)/1.015488);
	} else if(t >= 96.176956 && t < 97.177078) {
		p = mix(vec3(-5.990775, 6.033623, -5.725171),vec3(-5.946074, 6.055099, -5.675757), abs(97.177078 - t)/1.000122);
		d = mix(vec3(0.289057, -0.275637, -0.916772),vec3(-0.604946, -0.309017, -0.733859), abs(97.177078 - t)/1.000122);
	} else if(t >= 97.177078 && t < 98.193581) {
		p = mix(vec3(-5.990775, 6.033623, -5.725171),vec3(-5.990775, 6.033623, -5.725171), abs(98.193581 - t)/1.016502);
		d = mix(vec3(0.328771, -0.275637, -0.903291),vec3(0.289057, -0.275637, -0.916772), abs(98.193581 - t)/1.016502);
	} else if(t >= 98.193581 && t < 99.210930) {
		p = mix(vec3(-5.990775, 6.033623, -5.725171),vec3(-5.990775, 6.033623, -5.725171), abs(99.210930 - t)/1.017349);
		d = mix(vec3(0.328771, -0.275637, -0.903291),vec3(0.328771, -0.275637, -0.903291), abs(99.210930 - t)/1.017349);
	} else if(t >= 99.210930 && t < 100.210983) {
		p = mix(vec3(-5.990775, 6.033623, -5.725171),vec3(-5.990775, 6.033623, -5.725171), abs(100.210983 - t)/1.000053);
		d = mix(vec3(0.328771, -0.275637, -0.903291),vec3(0.328771, -0.275637, -0.903291), abs(100.210983 - t)/1.000053);
	} else if(t >= 100.210983 && t < 101.210983) {
		p = mix(vec3(-6.258072, 6.103697, -5.673536), vec3(-5.990775, 6.033623, -5.725171), abs(101.210983 - t));
		d = mix(vec3(0, 0, -1), vec3(0.328771, -0.275637, -0.903291), abs(101.210983 - t));
	}
}

void main() {
	vec2 p = -2.0 + 4.0*(gl_FragCoord.xy/resolution);
	p.x *= resolution.x/resolution.y;

	vec3 ro = vec3(-6.258072, 6.103697, -5.673536);
	vec3 ww = vec3(0.000000, 0.000000, -1.000000);

	cameraPath(ro, ww, time);
	ww = normalize(ww);
	vec3 uu = normalize(cross(ww, vec3(0, 1, 0)));
	vec3 vv = normalize(cross(uu, ww));
	vec3 rd = normalize(p.x*uu + p.y*vv + 1.97*ww);

	float t = 0.0;
	for(int i = 0; i < 300; i++) {
		float d = de(ro + rd*t);
		if(abs(d) < 0.001*t || t >= tmax) break;
		t += d*0.5;
	}

	vec3 col = vec3(0);

	if(t < tmax) {
		vec3 pos = ro + rd*t;
		vec2 h = vec2(0.001, 0.0);
		vec3 nor = normalize(vec3(
			de(pos + h.xyy) - de(pos - h.xyy),
			de(pos + h.yxy) - de(pos - h.yxy),
			de(pos + h.yyx) - de(pos - h.yyx)
		));

		float s = 0.01;
		float o = 0.0;
		for(int i = 0; i < 10; i++) {
			float d = de(pos + nor*s);
			o += (s - d);
			s += 0.01;
		}

		col = vec3(1.0 - clamp(o, 0.0, 1.0));
	}

	col = mix(col, vec3(0), 1.0 - exp(-0.4*t));
	col = pow(col, vec3(.454545));

	fragColor = vec4(col, 1);
}